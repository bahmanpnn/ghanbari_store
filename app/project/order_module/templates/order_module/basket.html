{% extends "base.html" %}
{% load static %}

{% block header_references %}
{% endblock header_references %}
{% block content %}
    <div class="rts-navigation-area-breadcrumb bg_light-1">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="navigator-breadcrumb-wrapper">
                        <a href="{% url "home_module:home-page" %}">صفحه اصلی</a>
                        <i class="fa-regular fa-chevron-left"></i>
                        <a class="current">سبد خرید</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="section-seperator bg_light-1">
        <div class="container">
            <hr class="section-seperator">
        </div>
    </div>  

    <!-- rts cart area start -->
    <div class="rts-cart-area rts-section-gap bg_light-1">
        <div class="container">
            <div class="row g-5" id="order-detail-content">
                {% include "order_module/includes/remove_order_detail_ajax.html" %}
            </div>
        </div>
    </div>
    <!-- rts cart area end -->
{% endblock content %}

{% block footer_references %}
    <script src="/static/order_module/js/custom.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const freeShippingRadio = document.getElementById("f-option");
            const flatRateRadio = document.getElementById("s-option");
            const totalPriceElement = document.getElementById("total_price_display");
            const shippingCostInput = document.getElementById("shipping_cost");
        
            function updateTotal() {
                let basketTotal = parseInt("{{ user_basket.get_total_amount }}");
                let shippingCost = freeShippingRadio.checked ? 0 : parseInt(shippingCostInput.value);
                let finalTotal = basketTotal + shippingCost;
                totalPriceElement.innerText = finalTotal.toLocaleString() + " تومان";
            }
        
            freeShippingRadio?.addEventListener("change", updateTotal);
            flatRateRadio?.addEventListener("change", updateTotal);
        
            updateTotal();  // Ensure total is calculated on page load
        });
    </script>
    <script>
        document.getElementById("apply-coupon-form").addEventListener("submit", function (e) {
            e.preventDefault();
        
            let form = this;
            let formData = new FormData(form);
            let csrfToken = form.querySelector("[name=csrfmiddlewaretoken]").value;
        
            fetch(form.action, {
                method: "POST",
                body: formData,
                headers: {
                    "X-CSRFToken": csrfToken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    // Update order details
                    let orderDetailContent = document.getElementById("order-detail-content");
                    if (orderDetailContent) {
                        orderDetailContent.innerHTML = data.body;
                    }
        
                    // insert the success message after updating content
                    let messageBox = document.getElementById("coupon-message");
                    messageBox.textContent = data.message;
                    messageBox.style.color = "green";
                    
                } else {
                    // Handle error messages without updating content
                    let messageBox = document.getElementById("coupon-message");
                    if (messageBox) {
                        messageBox.textContent = data.message;
                        messageBox.style.color = "red";
                    }
                }
            })
            .catch(error => console.error("Error:", error));
        });
    </script>
    {% comment %} <script>
        document.getElementById("apply-coupon-form").addEventListener("submit", function (e) {
            e.preventDefault();
        
            let form = this;
            let formData = new FormData(form);
            let csrfToken = form.querySelector("[name=csrfmiddlewaretoken]").value;
        
            fetch(form.action, {
                method: "POST",
                body: formData,
                headers: {
                    "X-CSRFToken": csrfToken
                }
            })
            .then(response => response.json())
            .then(data => {
                let messageBox = document.getElementById("coupon-message");
                messageBox.textContent = data.message;
                messageBox.style.color = data.status === "success" ? "green" : "red";
        
                if (data.status === "success") {
                    $('#order-detail-content').html(data.body);
                    let messageBox = document.getElementById("coupon-message");
                    messageBox.textContent = data.message;
                    messageBox.style.color = data.status === "success" ? "green" : "red";
                    // Update total amount
                    //document.getElementById("total-amount").textContent = data.new_total.toLocaleString();
                }
            })
            .catch(error => console.error("Error:", error));
        });        
    </script> {% endcomment %}
{% endblock footer_references %}




      











